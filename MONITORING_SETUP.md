# Настройка непрерывного мониторинга

## ✅ Изменения внесены

### Что изменилось:

1. **Добавлен режим непрерывного мониторинга**
   - Когда приложение доходит до текущей даты, оно не останавливается
   - Переходит в режим мониторинга и периодически проверяет наличие новых данных
   - Интервал проверки: **30 минут**

2. **Логика работы:**
   - Обрабатывает все даты до текущей
   - При достижении текущей даты проверяет наличие данных
   - Если данных нет - переходит в режим ожидания
   - Периодически (каждые 30 минут) проверяет наличие новых данных
   - Когда данные появляются - автоматически обрабатывает их
   - Продолжает мониторинг бесконечно

3. **Учет времени загрузки данных:**
   - Данные в ЕИС загружаются в **2:00 ночи** за предыдущий день
   - Приложение учитывает это и мониторит вчерашнюю дату после 2:00 ночи

### Настройки мониторинга:

```python
MONITORING_INTERVAL = 30 * 60  # 30 минут
EIS_DATA_UPLOAD_TIME = 2  # 2:00 ночи
```

### Systemd Service:

- **Restart**: `always` (перезапускается при любых сбоях)
- **RestartSec**: 30 секунд
- **Автозапуск**: включен (`enabled`)

## Управление service

### Просмотр статуса:
```bash
sudo systemctl status tendermonitor
```

### Просмотр логов:
```bash
sudo journalctl -u tendermonitor -f
```

### Остановка:
```bash
sudo systemctl stop tendermonitor
```

### Запуск:
```bash
sudo systemctl start tendermonitor
```

### Перезапуск:
```bash
sudo systemctl restart tendermonitor
```

## Как это работает

1. **Обработка исторических данных:**
   - Приложение обрабатывает все даты от начальной до текущей
   - Пропускает уже обработанные регионы

2. **Достижение текущей даты:**
   - Когда доходит до сегодняшней даты, проверяет наличие данных
   - Если данных нет - переходит в режим мониторинга

3. **Режим мониторинга:**
   - Каждые 30 минут проверяет наличие новых данных
   - Делает легкий тестовый запрос к ЕИС
   - Если данные появились - обрабатывает их
   - Продолжает мониторинг

4. **Обработка новых данных:**
   - Когда данные появляются (после 2:00 ночи)
   - Автоматически обрабатывает вчерашнюю дату
   - Затем переходит к мониторингу текущей даты

## Преимущества

✅ **Непрерывная работа** - приложение работает 24/7
✅ **Автоматическая обработка** - новые данные обрабатываются автоматически
✅ **Устойчивость** - автоматический перезапуск при сбоях
✅ **Эффективность** - проверяет наличие данных перед полной обработкой

## Текущий статус

✅ **Service запущен и работает**
✅ **Обрабатывает данные**
✅ **Готов к переходу в режим мониторинга**
