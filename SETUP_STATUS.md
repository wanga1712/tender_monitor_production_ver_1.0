# –°—Ç–∞—Ç—É—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Stunnel –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. **–≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å Windows:**
   - ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ `F:\sertification\user_cert.pfx` –≤ `certificate.cer`
   - ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ: 17.01.2027

2. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   - ‚úÖ `certificate.cer` ‚Üí `/tmp/certificate.cer` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - ‚úÖ `server_cert.cer` ‚Üí `/tmp/server_cert.cer` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - ‚úÖ `setup_stunnel_linux.sh` ‚Üí `/tmp/setup_stunnel_linux.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

3. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
   - ‚úÖ `/etc/opt/cprocsp/stunnel` - —Å–æ–∑–¥–∞–Ω–∞
   - ‚úÖ `/var/opt/cprocsp/tmp` - —Å–æ–∑–¥–∞–Ω–∞

4. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:**
   - ‚úÖ `/etc/opt/cprocsp/stunnel/1.cer` - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (2287 –±–∞–π—Ç)
   - ‚úÖ `/etc/opt/cprocsp/stunnel/server_cert.cer` - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (1478 –±–∞–π—Ç)
   - ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (644)

5. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ stunnel.conf:**
   - ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ `/etc/opt/cprocsp/stunnel/stunnel.conf`
   - ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ Windows –≤–∫–ª—é—á–µ–Ω—ã:
     - `cert = /etc/opt/cprocsp/stunnel/1.cer`
     - `pin = 0532`
     - `CAfile = /etc/opt/cprocsp/stunnel/server_cert.cer`
     - `verify = 0`
     - `debug = 7`
     - `socket = l:TCP_NODELAY=1`
     - `socket = r:TCP_NODELAY=1`

## ‚úÖ –í–°–ï –ù–ê–°–¢–†–û–ï–ù–û!

–í—Å–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP.

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

**–°—Ç–∞—Ç—É—Å:** ‚ùå –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å)

**–î–µ–π—Å—Ç–≤–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP 5.0.12000 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Stunnel –∏ –ì–û–°–¢2012

**–°—Å—ã–ª–∫–∞:** https://cryptopro.ru/products/csp/downloads

**–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã:**
- `/opt/cprocsp/sbin/amd64/stunnel_thread`
- `/opt/cprocsp/sbin/amd64/stunnel_fork`

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
ssh nyx
/opt/cprocsp/bin/amd64/certmgr -inst -store uMy -file /etc/opt/cprocsp/stunnel/1.cer
/opt/cprocsp/bin/amd64/certmgr -list -store uMy
```

### 3. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ Stunnel

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP:

```bash
# –ó–∞–ø—É—Å–∫ Stunnel
sudo /opt/cprocsp/sbin/amd64/stunnel_thread /etc/opt/cprocsp/stunnel/stunnel.conf

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
netstat -tuln | grep 8080

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:8080

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f /var/opt/cprocsp/tmp/stunnel.log
```

## üìã –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª: `/etc/opt/cprocsp/stunnel/stunnel.conf`

```ini
cert = /etc/opt/cprocsp/stunnel/1.cer
pid = /var/opt/cprocsp/tmp/stunnel_cli.pid
output = /var/opt/cprocsp/tmp/stunnel.log
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
debug = 7
client = yes

[https]
accept = localhost:8080
connect = int44.zakupki.gov.ru:443
pin = 0532
CAfile = /etc/opt/cprocsp/stunnel/server_cert.cer
verify = 0
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Stunnel** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
4. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫** —á–µ—Ä–µ–∑ systemd (—Å–º. `STUNNEL_INSTALLATION.md`)

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –≤—Å–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ Windows.
