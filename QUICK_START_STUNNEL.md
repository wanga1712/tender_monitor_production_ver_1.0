# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stunnel –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä–µ nyx

## ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü—Ä–æ–µ–∫—Ç **–Ω–∞–π–¥–µ–Ω** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: `/opt/tendermonitor`

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å Windows

–ù–∞ Windows –º–∞—à–∏–Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```powershell
# –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ —Ä–µ–µ—Å—Ç—Ä–µ
.\export_certificate_windows.ps1

# –ò–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å .pfx —Ñ–∞–π–ª (F:\sertification\user_cert.pfx)
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ .cer (—Å–º. CERTIFICATE_MIGRATION.md)
```

### 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```powershell
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
scp certificate.cer wanga@nyx:/tmp/certificate.cer

# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
scp F:\sertification\server_cert.cer wanga@nyx:/tmp/server_cert.cer
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stunnel –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh nyx

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω)
# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sudo chmod +x /tmp/setup_stunnel_linux.sh
sudo /tmp/setup_stunnel_linux.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç stunnel.conf —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ Windows
- ‚úÖ –ó–∞–ø—Ä–æ—Å–∏—Ç PIN-–∫–æ–¥ (0532)

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /etc/opt/cprocsp/stunnel

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo cp /tmp/certificate.cer /etc/opt/cprocsp/stunnel/1.cer
sudo chmod 644 /etc/opt/cprocsp/stunnel/1.cer

# –ï—Å–ª–∏ –µ—Å—Ç—å server_cert.cer
sudo cp /tmp/server_cert.cer /etc/opt/cprocsp/stunnel/server_cert.cer
sudo chmod 644 /etc/opt/cprocsp/stunnel/server_cert.cer
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞ –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

**–í–ê–ñ–ù–û:** –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –Ω–∞ Linux —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–ª—é—á—É.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–µ—Ä–µ–∑ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP
/opt/cprocsp/bin/amd64/certmgr -inst -store uMy -file /etc/opt/cprocsp/stunnel/1.cer

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
/opt/cprocsp/bin/amd64/certmgr -list -store uMy
```

### 6. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ Stunnel

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Stunnel
sudo /opt/cprocsp/sbin/amd64/stunnel_thread /etc/opt/cprocsp/stunnel/stunnel.conf

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 8080 —Å–ª—É—à–∞–µ—Ç—Å—è
netstat -tuln | grep 8080

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost:8080

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f /var/opt/cprocsp/tmp/stunnel.log
```

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è stunnel.conf

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ Windows:

```ini
cert = /etc/opt/cprocsp/stunnel/1.cer
pid = /var/opt/cprocsp/tmp/stunnel_cli.pid
output = /var/opt/cprocsp/tmp/stunnel.log
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
debug = 7
client = yes

[https]
accept = localhost:8080
connect = int44.zakupki.gov.ru:443
pin = 0532
CAfile = /etc/opt/cprocsp/stunnel/server_cert.cer
verify = 0
```

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –¥–ª—è Linux:** https://cryptopro.ru/products/csp/downloads
- **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:** `STUNNEL_INSTALLATION.md`
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:** `CERTIFICATE_MIGRATION.md`

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx
2. **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–ª—é—á—É
3. **PIN-–∫–æ–¥** –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Windows –≤–µ—Ä—Å–∏–µ–π (0532)
4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **nginx**, –Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ **stunnel**

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/opt/cprocsp/tmp/stunnel.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `ls -la /opt/cprocsp/sbin/amd64/stunnel*`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º: `ls -la /etc/opt/cprocsp/stunnel/`
4. –°–º. —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –≤ `STUNNEL_INSTALLATION.md`
