# –°–≤–æ–¥–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–µ–∫—Ç **–Ω–∞–π–¥–µ–Ω** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/tendermonitor`

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **nginx** –≤–º–µ—Å—Ç–æ stunnel
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `/etc/nginx/conf.d/eis.conf`
- Nginx –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**

**–î–µ–π—Å—Ç–≤–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP 5.0.12000 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Stunnel –∏ –ì–û–°–¢2012

**–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:** https://cryptopro.ru/products/csp/downloads

**–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã:**
- `/opt/cprocsp/sbin/amd64/stunnel_thread`
- `/opt/cprocsp/sbin/amd64/stunnel_fork`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stunnel

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É stunnel

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx

1. –°–∫–∞—á–∞–π—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –¥–ª—è Linux (RedOS 7.3.3)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   ssh nyx
   sudo rpm -ivh cprocsp-*.rpm
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É:
   ```bash
   ls -la /opt/cprocsp/sbin/amd64/stunnel*
   ```

### –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ–Ω–æ—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

**–ù–∞ Windows –º–∞—à–∏–Ω–µ:**

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
   ```powershell
   .\export_certificate_windows.ps1
   ```
   –ò–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ .pfx (—Å–º. `CERTIFICATE_MIGRATION.md`)

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   ```powershell
   scp certificate.cer wanga@nyx:/tmp/certificate.cer
   scp F:\sertification\server_cert.cer wanga@nyx:/tmp/server_cert.cer
   ```

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx:**

```bash
ssh nyx
sudo mkdir -p /etc/opt/cprocsp/stunnel
sudo cp /tmp/certificate.cer /etc/opt/cprocsp/stunnel/1.cer
sudo chmod 644 /etc/opt/cprocsp/stunnel/1.cer

# –ï—Å–ª–∏ –µ—Å—Ç—å server_cert.cer
sudo cp /tmp/server_cert.cer /etc/opt/cprocsp/stunnel/server_cert.cer
sudo chmod 644 /etc/opt/cprocsp/stunnel/server_cert.cer
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
/opt/cprocsp/bin/amd64/certmgr -inst -store uMy -file /etc/opt/cprocsp/stunnel/1.cer

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
/opt/cprocsp/bin/amd64/certmgr -list -store uMy
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stunnel

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Å Windows –º–∞—à–∏–Ω—ã)
scp setup_stunnel_linux.sh wanga@nyx:/tmp/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
ssh nyx
sudo chmod +x /tmp/setup_stunnel_linux.sh
sudo /tmp/setup_stunnel_linux.sh
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ Windows:
- `cert = /etc/opt/cprocsp/stunnel/1.cer`
- `pin = 0532` (–∑–∞–ø—Ä–æ—Å–∏—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏)
- `CAfile = /etc/opt/cprocsp/stunnel/server_cert.cer` (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `verify = 0`
- `debug = 7`

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Stunnel
sudo /opt/cprocsp/sbin/amd64/stunnel_thread /etc/opt/cprocsp/stunnel/stunnel.conf

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
netstat -tuln | grep 8080

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost:8080

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f /var/opt/cprocsp/tmp/stunnel.log
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–º. —Ä–∞–∑–¥–µ–ª "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Stunnel —á–µ—Ä–µ–∑ systemd" –≤ `STUNNEL_INSTALLATION.md`

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **setup_stunnel_linux.sh** - –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ stunnel
2. **CERTIFICATE_MIGRATION.md** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
3. **STUNNEL_INSTALLATION.md** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
4. **QUICK_START_STUNNEL.md** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
5. **SERVER_SETUP_SUMMARY.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª (—Å–≤–æ–¥–∫–∞)

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ —Å nginx –Ω–∞ stunnel

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è nginx (`/etc/nginx/conf.d/eis.conf`)
- Nginx –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ stunnel:**
- Stunnel –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `localhost:8080`
- Nginx –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å stunnel –≤–º–µ—Å—Ç–æ nginx

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–æ–¥ –≤ `proxy_runner.py` —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (Windows/stunnel –∏ Linux/nginx). –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ stunnel –Ω–∞ Linux, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `proxy_runner.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è stunnel –≤–º–µ—Å—Ç–æ nginx –Ω–∞ Linux.

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ nyx
2. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP
4. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ stunnel
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É stunnel
6. ‚è≥ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd

## üÜò –ü—Ä–æ–±–ª–µ–º—ã?

–°–º. —Ä–∞–∑–¥–µ–ª—ã "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –≤:
- `STUNNEL_INSTALLATION.md`
- `CERTIFICATE_MIGRATION.md`
